import { NextRequest, NextResponse } from "next/server";
import prisma from "@/lib/db/prisma";

export const dynamic = "force-dynamic";

// GET - Fetch draft prospects for public display
export async function GET(request: NextRequest) {
  try {
    const searchParams = request.nextUrl.searchParams;
    const year = searchParams.get("year") || "2026";

    const prospects = await prisma.draftProspect.findMany({
      where: {
        draftYear: parseInt(year),
      },
      orderBy: { rank: "asc" },
    });

    if (prospects.length === 0) {
      // Return fallback data
      return NextResponse.json({
        success: true,
        prospects: getFallbackProspects(),
        year: parseInt(year),
        source: "fallback",
      });
    }

    return NextResponse.json({
      success: true,
      prospects,
      year: parseInt(year),
      source: "database",
    });
  } catch (error) {
    console.error("Error fetching draft prospects:", error);
    return NextResponse.json({
      success: true,
      prospects: getFallbackProspects(),
      year: 2026,
      source: "fallback",
    });
  }
}

function getFallbackProspects() {
  return [
    {
      id: "1",
      rank: 1,
      name: "Darryn Peterson",
      position: "PG/SG",
      school: "Kansas",
      height: "6'6\"",
      weight: 205,
      age: 19,
      ppg: 21.1,
      rpg: 4.3,
      apg: 1.8,
      fgPct: 49.4,
      threePct: 43.2,
      ftPct: 80.6,
      strengths: ["Elite scoring ability", "Three-point shooting", "Shot creation", "Size for position"],
      weaknesses: ["Health/durability concerns", "Assist numbers", "Defensive consistency"],
      comparison: "Devin Booker",
      projectedPick: "1-3",
      draftYear: 2026,
      espnId: "5041955",
    },
    {
      id: "2",
      rank: 2,
      name: "Cameron Boozer",
      position: "PF",
      school: "Duke",
      height: "6'9\"",
      weight: 250,
      age: 18,
      ppg: 23.3,
      rpg: 9.9,
      apg: 4.0,
      fgPct: 58.3,
      threePct: 37.5,
      ftPct: 75.8,
      strengths: ["Scoring inside and out", "Rebounding", "Passing for size", "Motor and competitiveness"],
      weaknesses: ["Lateral quickness", "Rim protection", "Defensive positioning"],
      comparison: "Chris Bosh",
      projectedPick: "1-3",
      draftYear: 2026,
      espnId: "5041935",
    },
    {
      id: "3",
      rank: 3,
      name: "AJ Dybantsa",
      position: "SF",
      school: "BYU",
      height: "6'9\"",
      weight: 210,
      age: 19,
      ppg: 23.6,
      rpg: 6.7,
      apg: 3.6,
      fgPct: 53.0,
      threePct: 31.8,
      ftPct: 76.2,
      strengths: ["Elite scoring volume", "Length and athleticism", "Versatility", "Finishing at the rim"],
      weaknesses: ["Three-point consistency", "Shot selection", "Turnover-prone"],
      comparison: "Jayson Tatum",
      projectedPick: "1-3",
      draftYear: 2026,
      espnId: "5142718",
    },
    {
      id: "4",
      rank: 4,
      name: "Kingston Flemings",
      position: "PG",
      school: "Houston",
      height: "6'4\"",
      weight: 190,
      age: 19,
      ppg: 16.1,
      rpg: 3.3,
      apg: 5.0,
      fgPct: 53.5,
      threePct: 42.6,
      ftPct: 78.0,
      strengths: ["NBA-caliber speed", "Court vision", "Three-point shooting", "Defensive instincts"],
      weaknesses: ["Finishing over length", "Size for position", "Turnover management"],
      comparison: "Jrue Holiday",
      projectedPick: "4-8",
      draftYear: 2026,
      espnId: "5149077",
    },
    {
      id: "5",
      rank: 5,
      name: "Caleb Wilson",
      position: "SF/PF",
      school: "North Carolina",
      height: "6'10\"",
      weight: 215,
      age: 19,
      ppg: 20.0,
      rpg: 9.8,
      apg: 2.8,
      fgPct: 58.1,
      threePct: 25.0,
      ftPct: 70.4,
      strengths: ["Elite motor", "Physicality", "Rebounding", "Attacking the basket"],
      weaknesses: ["Three-point shooting", "Free throw shooting", "Perimeter game"],
      comparison: "Pascal Siakam",
      projectedPick: "4-8",
      draftYear: 2026,
      espnId: "5095151",
    },
    {
      id: "6",
      rank: 6,
      name: "Keaton Wagler",
      position: "SG",
      school: "Illinois",
      height: "6'6\"",
      weight: 185,
      age: 19,
      ppg: 17.9,
      rpg: 5.0,
      apg: 4.3,
      fgPct: 48.0,
      threePct: 44.4,
      ftPct: 80.7,
      strengths: ["Elite three-point shooting", "Scoring versatility", "Playmaking", "Size for guard"],
      weaknesses: ["Needs to add strength", "Defensive consistency", "Finishing through contact"],
      comparison: "Klay Thompson",
      projectedPick: "5-10",
      draftYear: 2026,
      espnId: "5254165",
    },
    {
      id: "7",
      rank: 7,
      name: "Mikel Brown Jr.",
      position: "PG",
      school: "Louisville",
      height: "6'5\"",
      weight: 190,
      age: 20,
      ppg: 15.6,
      rpg: 3.0,
      apg: 5.1,
      fgPct: 37.4,
      threePct: 27.8,
      ftPct: 80.5,
      strengths: ["Playmaking vision", "Size for position", "Ball handling", "Court generalship"],
      weaknesses: ["Shooting efficiency", "Health concerns", "Three-point shooting"],
      comparison: "Darius Garland",
      projectedPick: "6-12",
      draftYear: 2026,
      espnId: "5101761",
    },
    {
      id: "8",
      rank: 8,
      name: "Nate Ament",
      position: "SF",
      school: "Tennessee",
      height: "6'10\"",
      weight: 207,
      age: 19,
      ppg: 17.1,
      rpg: 6.4,
      apg: 2.5,
      fgPct: 41.8,
      threePct: 31.1,
      ftPct: 76.5,
      strengths: ["Length and wingspan", "Scoring versatility", "Defensive potential", "Competitive motor"],
      weaknesses: ["Shooting consistency", "Needs to add weight", "Playmaking development"],
      comparison: "Brandon Ingram",
      projectedPick: "6-12",
      draftYear: 2026,
      espnId: "5164559",
    },
    {
      id: "9",
      rank: 9,
      name: "Labaron Philon",
      position: "PG",
      school: "Alabama",
      height: "6'4\"",
      weight: 175,
      age: 20,
      ppg: 21.4,
      rpg: 3.5,
      apg: 4.9,
      fgPct: 51.1,
      threePct: 38.5,
      ftPct: 75.4,
      strengths: ["Shot creation", "Explosive scoring", "Clutch performance", "Off-dribble shooting"],
      weaknesses: ["Size and frame", "Defensive effort", "Turnover management"],
      comparison: "Trae Young",
      projectedPick: "8-14",
      draftYear: 2026,
      espnId: "4873090",
    },
    {
      id: "10",
      rank: 10,
      name: "Braylon Mullins",
      position: "SG",
      school: "UConn",
      height: "6'6\"",
      weight: 196,
      age: 20,
      ppg: 11.8,
      rpg: 3.4,
      apg: 1.4,
      fgPct: 47.3,
      threePct: 38.0,
      ftPct: 81.3,
      strengths: ["Elite shooting mechanics", "Basketball IQ", "Competitive fire", "Catch-and-shoot"],
      weaknesses: ["Creating off dribble", "Playmaking", "Injury history"],
      comparison: "Desmond Bane",
      projectedPick: "8-14",
      draftYear: 2026,
      espnId: "5196916",
    },
    {
      id: "11",
      rank: 11,
      name: "Hannes Steinbach",
      position: "PF",
      school: "Washington",
      height: "6'11\"",
      weight: 220,
      age: 20,
      ppg: 17.8,
      rpg: 11.5,
      apg: 1.8,
      fgPct: 53.7,
      threePct: 35.1,
      ftPct: 76.6,
      strengths: ["Double-double machine", "Soft touch", "Three-point range for size", "Rebounding instincts"],
      weaknesses: ["Lateral quickness", "Defensive versatility", "Foot speed in space"],
      comparison: "Lauri Markkanen",
      projectedPick: "10-15",
      draftYear: 2026,
      espnId: "5281370",
    },
    {
      id: "12",
      rank: 12,
      name: "Koa Peat",
      position: "PF",
      school: "Arizona",
      height: "6'8\"",
      weight: 235,
      age: 19,
      ppg: 14.8,
      rpg: 5.6,
      apg: 2.0,
      fgPct: 57.0,
      threePct: 35.3,
      ftPct: 60.8,
      strengths: ["Physical strength", "Finishing at rim", "Defensive versatility", "Body control"],
      weaknesses: ["Free throw shooting", "Perimeter game", "Offensive polish"],
      comparison: "Julius Randle",
      projectedPick: "10-16",
      draftYear: 2026,
      espnId: "5041953",
    },
    {
      id: "13",
      rank: 13,
      name: "Darius Acuff",
      position: "PG",
      school: "Arkansas",
      height: "6'3\"",
      weight: 190,
      age: 19,
      ppg: 15.2,
      rpg: 3.2,
      apg: 5.5,
      fgPct: 44.0,
      threePct: 36.5,
      ftPct: 82.0,
      strengths: ["Playmaking instincts", "Speed in transition", "Passing vision", "Leadership"],
      weaknesses: ["Size for NBA", "Finishing over length", "Defensive impact"],
      comparison: "Tyrese Haliburton",
      projectedPick: "12-18",
      draftYear: 2026,
      espnId: "",
    },
    {
      id: "14",
      rank: 14,
      name: "Brayden Burries",
      position: "SG/PG",
      school: "Arizona",
      height: "6'4\"",
      weight: 205,
      age: 20,
      ppg: 14.5,
      rpg: 3.8,
      apg: 4.0,
      fgPct: 45.5,
      threePct: 37.0,
      ftPct: 79.5,
      strengths: ["Two-way play", "Physicality", "Shooting", "Defensive versatility"],
      weaknesses: ["Shot creation", "Turnover-prone", "Consistency"],
      comparison: "Marcus Smart",
      projectedPick: "12-18",
      draftYear: 2026,
      espnId: "",
    },
    {
      id: "15",
      rank: 15,
      name: "Thomas Haugh",
      position: "PF",
      school: "Florida",
      height: "6'9\"",
      weight: 215,
      age: 22,
      ppg: 13.5,
      rpg: 7.2,
      apg: 2.2,
      fgPct: 50.5,
      threePct: 38.0,
      ftPct: 77.0,
      strengths: ["Three-point shooting", "Basketball IQ", "Offensive versatility", "Toughness"],
      weaknesses: ["Age relative to class", "Athletic ceiling", "Defensive foot speed"],
      comparison: "Sam Hauser",
      projectedPick: "14-20",
      draftYear: 2026,
      espnId: "",
    },
  ];
}
